<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="STELLA - Smart Tool for Earning, Listing, Logging & Action" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#9b0f63" />
  <link rel="icon" type="image/png" href="assets/icon-192.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <title>STELLA</title>
</head>
<body>
  <header>
    <div style="display: flex; align-items: center; justify-content: center; gap: 1rem; flex-wrap: wrap;">
      <img src="UWLogoTP.png" alt="UW Logo" style="height: 60px;" />
      <h1>STELLA</h1>
    </div>
    <nav>
      <button onclick="switchTab('home')">🏠 Home</button>
      <button onclick="switchTab('dashboard')">📊 Dashboard</button>
      <button onclick="switchTab('add')">➕ Add Contact</button>
      <button onclick="switchTab('view')">📇 View Contacts</button>
      <button onclick="switchTab('log')">📝 Tracker</button>
      <button onclick="resetApp()" style="background: #ff4444; color: white;">🔄 Reset App</button>
    </nav>
  </header>

  <!-- Edit Contact Modal -->
  <div id="editContactModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h3>Edit Contact</h3>
      <form id="editContactForm">
        <div class="form-group">
          <label for="editName">Name:</label>
          <input type="text" id="editName" required>
        </div>
        <div class="form-group">
          <label for="editEmail">Email:</label>
          <input type="email" id="editEmail">
        </div>
        <div class="form-group">
          <label for="editTelephone">Telephone:</label>
          <input type="tel" id="editTelephone">
        </div>
        <div class="form-group">
          <label for="editCategory">Category:</label>
          <select id="editCategory" required>
            <option value="Friends & Family">Friends & Family</option>
            <option value="Recreation">Recreation</option>
            <option value="Occupation">Occupation</option>
            <option value="Geographic">Geographic</option>
            <option value="Same Name">Same Name</option>
          </select>
        </div>
        <div class="form-group">
          <label for="editNotes">Notes:</label>
          <textarea id="editNotes"></textarea>
        </div>
        <button type="submit">Save Changes</button>
      </form>
    </div>
  </div>

  <!-- Onboarding Modal -->
  <div id="onboardingModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <img src="UWLogoTP.png" alt="UW Logo" style="height: 40px;" />
        <h2>Welcome to STELLA!</h2>
      </div>
      <div class="modal-body">
        <p>Are you a new partner (less than 30 days, <6 customers) or an established partner?</p>
        <div class="partner-type-selection">
          <button id="newPartnerBtn" class="partner-btn"><span class="icon">🧑</span>I'm a new partner</button>
          <button id="establishedPartnerBtn" class="partner-btn"><span class="icon">🧑‍🎓</span>I'm an established partner</button>
        </div>
        
        <!-- New Partner Form -->
        <div id="newPartnerForm" class="partner-form" style="display: none;">
          <label>Join Date: <input type="date" id="joinDate" required /></label>
          <label>Current Customer Count: <input type="number" id="customerCount" min="0" /></label>
          <button type="button" id="startFastStart">Begin Fast Start</button>
        </div>

        <!-- Established Partner Form -->
        <div id="establishedPartnerForm" class="partner-form" style="display: none;">
          <label>Join Date: <input type="date" id="establishedJoinDate" required /></label>
          <label>Current "Stairway to Success" Level:
            <select id="currentLevel" required>
              <option value="">Select your level</option>
              <option value="QD">Qualified Distributor (QD)</option>
              <option value="QDStar">Qualified Distributor ⭐️ (QD Star)</option>
              <option value="SQD">Senior Qualified Distributor (SQD)</option>
              <option value="FTL">Future Team Leader (FTL)</option>
              <option value="TL">Team Leader (TL)</option>
              <option value="STL">Senior Team Leader (STL)</option>
              <option value="GL">Group Leader (GL)</option>
              <option value="SGL">Senior Group Leader (SGL)</option>
              <option value="NGL">National Group Leader (NGL)</option>
              <option value="NNL">National Network Leader (NNL)</option>
            </select>
          </label>
          <label>Current Customer Count: <input type="number" id="establishedCustomerCount" min="0" required /></label>
          <label>Current Partner Count: <input type="number" id="establishedPartnerCount" min="0" required /></label>
          <label>Target Level:
            <select id="targetLevel" required>
              <option value="">Select target level</option>
              <option value="QDStar">Qualified Distributor ⭐️ (QD Star)</option>
              <option value="SQD">Senior Qualified Distributor (SQD)</option>
              <option value="FTL">Future Team Leader (FTL)</option>
              <option value="TL">Team Leader (TL)</option>
              <option value="STL">Senior Team Leader (STL)</option>
              <option value="GL">Group Leader (GL)</option>
              <option value="SGL">Senior Group Leader (SGL)</option>
              <option value="NGL">National Group Leader (NGL)</option>
              <option value="NNL">National Network Leader (NNL)</option>
            </select>
          </label>
          <label>Target Date: <input type="date" id="targetDate" required /></label>
          <button type="button" id="setGoals">Set My Goals</button>
        </div>
      </div>
    </div>
  </div>

  <main>
    <section id="home" class="tab">
      <h2>Welcome</h2>
      <p>
        🌟 <strong>Welcome to STELLA</strong> - your Smart Tool for Earning, Listing, Logging & Action<br />
        Your Smart Team-Builder, Coach & Daily Companion.
      </p>
      <p>
        Whether you're just starting out or building momentum, STELLA is here to guide you every step of the way.<br />
        Track your progress. Get expert scripts. Build belief. Take action — daily.
      </p>
      <p>
        💡 <strong>Tip:</strong> Tap 'Get Started' for today's focus, or explore scripts and tools when you need a boost.
      </p>
      <p>
        Let's grow your UW business — one conversation at a time. 🚀
      </p>
      <button id="getStartedBtn" class="primary-btn" style="margin-top: 1.5em;">Get Started</button>
    </section>

    <!-- Daily Focus Modal -->
    <div id="focusModal" class="modal" style="display:none;">
      <div class="modal-content" style="max-width:400px;">
        <span class="close" id="closeFocusModal">&times;</span>
        <h3>Today's Focus</h3>
        <div id="focusContent" style="margin-top:1em;"></div>
      </div>
    </div>

    <section id="dashboard" class="tab" style="display:none">
      <h2>Dashboard</h2>
      <div class="dashboard-grid">
        <div class="metric-card">
          <h3>Fast Start Progress</h3>
          <div class="progress-container">
            <div class="progress-item">
              <span>Customers: </span>
              <span id="customerProgress">0/6</span>
              <div class="progress-bar">
                <div id="customerProgressBar" class="progress-fill"></div>
              </div>
            </div>
            <div class="progress-item">
              <span>Partners: </span>
              <span id="partnerProgress">0/1</span>
              <div class="progress-bar">
                <div id="partnerProgressBar" class="progress-fill"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="metric-card">
          <h3>Activity Metrics</h3>
          <div class="metrics-grid">
            <div class="metric">
              <span class="metric-label">Invitations Sent</span>
              <span id="invitesCount" class="metric-value">0</span>
            </div>
            <div class="metric">
              <span class="metric-label">Appointments Set</span>
              <span id="appointmentsSetCount" class="metric-value">0</span>
            </div>
            <div class="metric">
              <span class="metric-label">Appointments Sat</span>
              <span id="appointmentsSatCount" class="metric-value">0</span>
            </div>
            <div class="metric">
              <span class="metric-label">Customers Signed</span>
              <span id="customersSignedCount" class="metric-value">0</span>
            </div>
            <div class="metric">
              <span class="metric-label">Partners Signed</span>
              <span id="partnersSignedCount" class="metric-value">0</span>
            </div>
            <div class="metric">
              <span class="metric-label">Invite to Customer Ratio</span>
              <span id="inviteCustomerRatio" class="metric-value">—</span>
            </div>
          </div>
        </div>

        <div class="metric-card">
          <h3>Time Tracking</h3>
          <div class="metrics-grid">
            <div class="metric">
              <span class="metric-label">Days in Business</span>
              <span id="dayCount" class="metric-value">0</span>
            </div>
            <div class="metric">
              <span class="metric-label">Days Remaining</span>
              <span id="daysRemaining" class="metric-value">30</span>
            </div>
          </div>
        </div>
      </div>
      <div id="motivationalMessage" class="motivational-message"></div>
    </section>

    <section id="add" class="tab" style="display:none">
      <h2>Add Contact</h2>
      <div id="contactForm" class="form-container">
        <h3>Add New Contact</h3>
        <form>
          <div class="form-group">
            <label for="name">Name:</label>
            <input type="text" id="name" required>
          </div>
          <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email">
          </div>
          <div class="form-group">
            <label for="telephone">Telephone:</label>
            <input type="tel" id="telephone">
          </div>
          <div class="form-group">
            <label for="category">Category:</label>
            <select id="category" required>
              <option value="Friends & Family">Friends & Family</option>
              <option value="Recreation">Recreation</option>
              <option value="Occupation">Occupation</option>
              <option value="Geographic">Geographic</option>
              <option value="Same Name">Same Name</option>
            </select>
          </div>
          <div class="form-group">
            <label for="notes">Notes:</label>
            <textarea id="notes"></textarea>
          </div>
          <button type="submit">Add Contact</button>
        </form>
      </div>

      <hr />
      <h3>Or Import from CSV</h3>
      <input type="file" accept=".csv" id="csvFileInput" />
      <div id="csvPreview"></div>
      <script>
        document.getElementById('csvFileInput').addEventListener('change', function () {
          if (this.files.length > 0) {
            handleCSVUpload(this.files[0], 'csvPreview');
          }
        });
      </script>
    </section>

    <section id="view" class="tab" style="display:none">
      <h2>Contact List</h2>
      <ul id="contact-list"></ul>
    </section>

    <section id="log" class="tab" style="display:none">
      <h2>Activity Tracker</h2>
      <form id="activityForm">
        <label for="activityType">Action Type:</label>
        <select id="activityType" required>
          <option value="Invite">Send Invitation</option>
          <option value="AppointmentSet">Appointment Set</option>
          <option value="AppointmentSat">Appointment Sat</option>
          <option value="CustomerSigned">Customer Signed</option>
          <option value="PartnerSigned">Partner Signed</option>
        </select><br />
        <label for="activityNote">Notes (optional):</label><br />
        <textarea id="activityNote" rows="3" placeholder="Any notes or context..."></textarea><br />
        <button type="submit">Log Action</button>
        <button type="button" id="suggestAIMessage">💡 Suggest Message</button>
      </form>

      <div id="aiMessageBox" style="margin-top:1em; display:none;">
        <strong>Suggested Message:</strong>
        <div id="aiMessageContent" style="white-space:pre-wrap; background:#f5f5f5; padding:10px; border-radius:6px; margin-top:5px;"></div>
        <button id="copyAIMessageBtn" style="margin-top:8px; display:block;">Copy</button>
      </div>

      <hr />
      <div id="activityLog"></div>
    </section>
  </main>

  <script src="app.js"></script>
  <script src="import.js"></script>
  <script src="onboarding.js"></script>
  <script src="ai.js"></script>
  <script src="data.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize tab switching
      const defaultTab = 'home';
      switchTab(defaultTab);
    });

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('sw.js').then(function (registration) {
          console.log('ServiceWorker registered with scope:', registration.scope);
        }, function (err) {
          console.log('ServiceWorker registration failed:', err);
        });
      });
    }
  </script>
</body>
</html>
